<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1. 符号定义</a></li>
  <li><a href="#fm" id="markdown-toc-fm">2. 度为2的FM模型</a></li>
  <li><a href="#fm-1" id="markdown-toc-fm-1">3. 度为2的FM模型的计算简化</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">4. 梯度</a></li>
  <li><a href="#dfm" id="markdown-toc-dfm">5. 度为d的FM模型</a></li>
</ul>

<h2 id="section">1. 符号定义</h2>

<ul>
  <li>稀疏训练集D：<script type="math/tex">{(x^{(1)}, y^{(1)}), (x^{(2)}, y^{(2)}),..., (x^{(m)}, y^{(m)})}</script></li>
  <li>第i个数据点：<script type="math/tex">x^{(i)}=(x^{(i)}_1, x^{(i)}_2,...,x^{(i)}_n)</script></li>
  <li><script type="math/tex">m(x^{i})</script>：数据点<script type="math/tex">x^{(i)}</script>的不为0的feature数量</li>
  <li><script type="math/tex">\bar{m}_D</script>：D中<script type="math/tex">m(x^{i})</script>的均值</li>
</ul>

<h2 id="fm">2. 度为2的FM模型</h2>

<p>度为2的预测函数
\begin{align}
y = w_0 + \sum\limits_{i=1}^nw_ix_i + \sum\limits_{i=1}^n\sum\limits_{j=i+1}^n&lt;v_i,v_j&gt;x_ix_j
\end{align}</p>

<p>式中的参数</p>

<p>\begin{align}
w_0 \in R \quad w\in R \quad v_i,v_j \in R^K
\end{align}</p>

<p>且<script type="math/tex">% <![CDATA[
<v_i, v_j> %]]></script>表示两个向量的点积</p>

<h2 id="fm-1">3. 度为2的FM模型的计算简化</h2>

<p>\begin{align}
\sum\limits_{i=1}^n\sum\limits_{j=i+1}^n&lt;v_i,v_j&gt;x_ix_j 
= &amp;\frac{1}{2}\sum\limits_{i=1}^n\sum\limits_{j=1}^n&lt;v_i,v_j&gt;x_ix_j-\frac{1}{2}\sum\limits_{i=1}^n&lt;v_i,v_i&gt;x_ix_i \\
= &amp;\frac{1}{2}\sum\limits_{i=1}^n\sum\limits_{j=1}^n\sum\limits_{k=1}^Kv_{i,k}v_{j,k}x_ix_j-\frac{1}{2}\sum\limits_{i=1}^n\sum\limits_{k=1}^Kv_{i,k}v_{i,k}x_ix_i \\
= &amp;\frac{1}{2}\sum\limits_{k=1}^K\sum\limits_{i=1}^n\sum\limits_{j=1}^nv_{i,k}v_{j,k}x_ix_j-\frac{1}{2}\sum\limits_{k=1}^K\sum\limits_{i=1}^nv_{i,k}v_{i,k}x_ix_i \\
= &amp;\frac{1}{2}\sum\limits_{k=1}^K \left( \left(\sum\limits_{i=1}^nv_{i,k}x_i\right)\left(\sum\limits_{j=1}^nv_{j,k}x_j\right)\right)-\frac{1}{2}\sum\limits_{k=1}^K\sum\limits_{i=1}^nv_{i,k}v_{i,k}x_ix_i \\
= &amp;\frac{1}{2}\sum\limits_{k=1}^K \left(\sum\limits_{i=1}^nv_{i,k}x_i\right)^2-\frac{1}{2}\sum\limits_{k=1}^K\sum\limits_{i=1}^nv_{i,k}^2x_i^2
\end{align}</p>

<p>于是</p>

<p>\begin{align}
y = w_0 + \sum\limits_{i=1}^nw_ix_i + \frac{1}{2}\sum\limits_{k=1}^K \left(\sum\limits_{i=1}^nv_{i,k}x_i\right)^2-\frac{1}{2}\sum\limits_{k=1}^K\sum\limits_{i=1}^nv_{i,k}^2x_i^2
\end{align}</p>

<p>上式的计算复杂度是O(Kn)</p>

<h2 id="section-1">4. 梯度</h2>

<p>\begin{align}
\frac{\partial y}{\partial w_0} &amp;= 1 \\
\frac{\partial y}{\partial w_{i\geq1}} &amp;= x_i \\
\frac{\partial y}{\partial v_{i,k}}&amp;= x_i\left(\sum\limits_{j=1}^nv_{j,k}x_j\right) - v_{i,k}x_i^2
\end{align}</p>

<h2 id="dfm">5. 度为d的FM模型</h2>

<p>\begin{align}
y = w_0 + \sum\limits_{i=1}^nw_ix_i + \sum\limits_{l=2}^d\sum\limits_{i_1=1}^n…\sum\limits_{i_l=i_{l-1}+1}^n\left(\prod_{j=1}^lx_{i_j}\right)\left(\sum\limits_{k=1}^{K_l}\prod_{j=1}^lv^{(l)}_{i_j,k}\right)
\end{align}</p>
